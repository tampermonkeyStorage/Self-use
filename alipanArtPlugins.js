window.alipanArtPlugins=window.alipanArtPlugins||function(t){var e={version:"1.0.3",build:"2025-05-27",init:t=>Promise.all([e.readyHls(),e.readyArtplayer()]).then(()=>e.initArtplayer(t)),readyHls:()=>{return window.Hls||unsafeWindow.Hls?Promise.resolve():e.loadScript("https://unpkg.com/hls.js/dist/hls.min.js")},readyArtplayer:()=>{return window.Artplayer||unsafeWindow.Artplayer?Promise.resolve():e.loadScript("https://unpkg.com/artplayer/dist/artplayer.js")},readySupported:()=>Promise.resolve(t).then(t=>{const{version:o}=e,n=GM_getValue("art-"+o,0),s=t.reduce((t,e)=>t+e.toString().length,0);if(n){if(2===new Set([n,s]).size)return Promise.reject()}else GM_setValue("art-"+o,s)}),readyM3u8Parser:()=>{return window.m3u8Parser||unsafeWindow.m3u8Parser?Promise.resolve():e.loadScript("https://unpkg.com/m3u8-parser/dist/m3u8-parser.min.js")},initArtplayer:o=>{if(o=e.initOption(o),!Array.isArray(o.quality)||!o.quality.find(t=>t&&t.url))return alert("获取播放信息失败，请刷新网页重试"),Promise.reject("No available playUrl");const n=window.Artplayer||unsafeWindow.Artplayer;return Object.assign(n,{ASPECT_RATIO:["default","自动","4:3","16:9"],AUTO_PLAYBACK_TIMEOUT:1e4,NOTICE_TIME:5e3}),Object.assign(n.utils,{loadScript:e.loadScript}),new n(o,o=>{t.forEach(t=>{o.plugins.add(t())}),o.on("resumeed",t=>{const{option:n}=o,{quality:s}=e.initOption({video_info:t});n.quality=s,e.readyM3u8Parser().thrn(()=>{e.loadStreaming(o)})}),o.on("reloaded",t=>{const{option:n,notice:s,i18n:i}=o,{url:r,type:a,quality:l,sublist:u}=e.initOption({video_info:t});if(Object.assign(n,{url:r,type:a,quality:l,sublist:u}),r)return o.switchUrl(r),void(s.show=`${i.get("Switch Video")}: ${n.file.name}`);s.show=`${i.get("Switch Video")}: ERRORR 视频地址不可用`})})},initOption:t=>{const e={container:"#artplayer",url:"",quality:[],type:"hls",autoplay:!0,autoPlayback:!0,aspectRatio:!0,contextmenu:[{html:"打赏作者",index:51,click:(t,e)=>{window.open("https://jsd.nn.ci/gh/tampermonkeyStorage/Self-use@master/appreciation.png","_blank"),t.show=!1}},{html:"检查更新",index:52,click:(t,e)=>{window.open("https://scriptcat.org/zh-CN/script-show-page/162","_blank"),t.show=!1}}],customType:{hls:(t,e,o)=>{const n=window.Hls||unsafeWindow.Hls;if(n.isSupported()){o.hls&&o.hls.destroy();const s=new n({maxBufferLength:60});s.loadSource(e),s.attachMedia(t),o.hls=s,o.on("destroy",()=>s.destroy())}else t.canPlayType("application/vnd.apple.mpegurl")?t.src=e:o.notice.show="Unsupported playback format: m3u8"}},flip:!0,icons:{loading:'<img src="https://artplayer.org/assets/img/ploading.gif">',state:'<img width="150" heigth="150" src="https://artplayer.org/assets/img/state.svg">',indicator:'<img width="16" heigth="16" src="https://artplayer.org/assets/img/indicator.svg">'},id:"",pip:!0,playbackRate:!0,screenshot:!0,setting:!0,subtitle:{url:"",type:"vtt",style:{color:"#fe9200"},escape:!1,encoding:"utf-8"},subtitleOffset:!1,hotkey:!0,fullscreen:!0,fullscreenWeb:!0},{video_info:o,video_file:n,video_items:s}=t||{};if(n){const{file_id:t,thumbnail:o=""}=n;Object.assign(e,{file:n,id:t,poster:o})}if(s&&((s.find(t=>t.file_id===e.id)||{}).default=!0,Object.assign(e,{filelist:s})),o){const{live_transcoding_task_list:t,live_transcoding_subtitle_task_list:n,meta:s,quick_video_list:i,quick_video_subtitle_list:r}=o.video_preview_play_info,a={QHD:"1440 超清",FHD:"1080 全高清",HD:"720 高清",SD:"540 标清",LD:"360 流畅"},l=(i||t||[]).map((t,e)=>t.url&&{...t,html:a[t.template_id],type:"hls"}).filter(Boolean);l.sort((t,e)=>e.template_height-t.template_height),(l.find(t=>t.url)||l[0]||{}).default=!0;const{url:u,type:c}=l.find(t=>t.default)||l[0];Object.assign(e,{quality:l,url:u,type:c});const p={chi:"中文字幕",zho:"中文字幕",eng:"英文字幕",jpn:"日文字幕"},d=(r||n||[]).map((t,e)=>t.url&&{...t,html:`${p[t.language]||t.language||"未知语言"}`,name:`${p[t.language]||t.language||"未知语言"} - 内镶字幕「vtt」`,type:"vtt"}).filter(Boolean);(d.find(t=>["chi","zho"].includes(t.language))||d[0]||{}).default=!0,Object.assign(e,{sublist:d})}return e},loadStreaming:t=>{const{hls:e,notice:o,i18n:n,option:{quality:s}}=t,i=s.find(t=>t&&t.default)||s.findLast(t=>t&&t.url);if(!i.url)return void(o.show=`${n.get("Switch Video")}: ERRORR 视频地址不可用`);const r=e.url=i.url;fetch(r).then(t=>t.ok?t.text():Promise.reject()).then(o=>{const n=new(window.m3u8Parser||unsafeWindow.m3u8Parser).Parser;n.push(o),n.end();const s=r.replace(/media.m3u8.+/,""),i=n.manifest.segments;e.bufferController.details.fragments.forEach((t,e)=>{const o=i[e];Object.assign(t,{baseurl:r,relurl:o.uri,url:s+o.uri})}),e.startLoad(t.currentTime)}).catch(t=>{throw o.show=t,t})},loadScript:t=>(window.instances||(window.instances={}),window.instances[t]||(window.instances[t]=new Promise((e,o)=>{const n=document.createElement("script");n.src=t,n.type="text/javascript",n.onload=e,n.onerror=o,Node.prototype.appendChild.call(document.head,n)})),window.instances[t])};return console.info(`%c alipanArtPlugins %c ${e.version} %c https://scriptcat.org/zh-CN/users/13895`,"color: #fff; background: #5f5f5f","color: #fff; background: #4bc729",""),e}([()=>t=>{const e=window.Hls||unsafeWindow.Hls,{hls:o,layers:n,notice:s,storage:i,constructor:{CONTEXTMENU:r,utils:{query:a,append:l,setStyle:u,clamp:c,debounce:p,throttle:d}}}=t;function h(){return f().then(t=>{const e=t.User.current();if(e){const{ON:o,authData:n,check:s,expire_time:r,updatedAt:a}=e.toJSON();if(3===[Math.max(Date.parse(a)+864e5-Date.now(),0),JSON.stringify(n)===JSON.stringify({aliyundrive:{uid:""+function(){try{return JSON.parse(localStorage.getItem("token")).user_id}catch(t){return""}}()}}),i.get(t._getAVPath(t.User._CURRENT_USER_KEY))===btoa(encodeURIComponent(JSON.stringify(r)))].filter(Boolean).length)return o?Math.max(s,0)?Math.max(Date.parse(a)+432e3-Date.now(),0)?e:m().then(t=>Math.max(Date.parse(t.toJSON().expire_time)-Date.now(),0)?t:(Object.assign(t.attributes,{ON:o,expire_time:r,check:s-1}),t._handleSaveResult(!0).then(()=>t))):m():e}return m()})}function m(){return f().then(t=>Promise.resolve().then(()=>{try{return JSON.parse(localStorage.getItem("token"))}catch(t){return Promise.reject()}}).then(e=>{const o=new t.User;return o.set("uinfo",e),o.set("gminfo",GM_info),o.set("pnum",i.get("pnum")),o.loginWithAuthData({uid:""+e.user_id},"aliyundrive").then(e=>{delete e.attributes.uinfo,delete e.attributes.gminfo;const{createdAt:o,updatedAt:n}=e.toJSON();o===n&&Object.assign(e.attributes,{expire_time:new Date(Date.now()+864e5).toISOString()}),e._handleSaveResult(!0);const{expire_time:s}=e.toJSON();return i.set(t._getAVPath(t.User._CURRENT_USER_KEY),btoa(encodeURIComponent(JSON.stringify(s)))),e})}))}function f(){const e=window.AV||unsafeWindow.AV;return e?(e.applicationId||e.init({appId:"sXXf4FFOZn2nFIj7LOFsqpLa-gzGzoHsz",appKey:"16s3qYecpVJXtVahasVxxq1V",serverURL:"https://sxxf4ffo.lc-cn-n1-shared.com"}),Promise.resolve(e)):Promise.reject(t.destroy())}function g(){w()||n.update({name:"sponsor",html:'\n                                   <div style="padding: 5px;"><div>喜欢这个脚本吗</div><div>赞助后可使用所有增强功能</div></div>\n                                   <div style="padding: 5px;min-width: 280px;display: flex;flex-wrap: nowrap;">\n                                       <button id="open-afdian" style="padding: 5px; margin: 0 5px;border: none; border-radius: 3px; background: #09aaff; color: white; cursor: pointer;flex: 1 1 0;">打开爱发电</button>\n                                       <button id="copy-order" style="padding: 5px; margin: 0 5px;border: none; border-radius: 3px; background: #09aaff; color: white; cursor: pointer;flex: 1 1 0;">复制订单号</button>\n                                       <button id="update-script" style="padding: 5px; margin: 0 5px;border: none; border-radius: 3px; background: #09aaff; color: white; cursor: pointer;flex: 1 1 0;">检查更新</button>\n                                   </div>\n                                   <div style="padding: 5px"><input type="text" id="order-input" placeholder="输入爱发电订单号，体验更多功能" style="min-width: 250px;padding: 5px;border: none;border-radius: 3px;color: #000;" autocomplete="off"></div>\n                                   <div style="border-top: 1px solid #c6c6c6;display: flex;flex-wrap: nowrap;">\n                                       <button id="cancel-order" style="padding: 5px; border: none; border-radius: 3px; background: #ff5555; color: white; cursor: pointer;flex: 1 1 0;">取消</button>\n                                       <button id="submit-order" style="padding: 5px; border: none; border-radius: 3px; background: #ffad00; color: white; cursor: pointer;flex: 1 1 0;">提交</button>\n                                   </div>\n                            ',tooltip:"感谢支持，赞助后不再提示",style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",background:"rgba(0, 0, 0, 0.7)",border:"1px solid #c6c6c6",borderRadius:"8px",textAlign:"center"},click:(e,o)=>{o.isTrusted||t.destroy(),t.mask.show=!1,t.loading.show=!1},mounted:e=>{t.pause();try{o.pauseBuffering()}catch(t){o.stopLoad()}setTimeout(()=>{t.mask.show=!1,t.loading.show=!1,t.controls.show=!1,t.setting.show=!1,t.constructor.CONTEXTMENU=!1},500);const n=a("#open-afdian",e),r=a("#copy-order",e),l=a("#update-script",e);t.proxy(n,"click",()=>{window.open("https://afdian.com/order/create?plan_id=be4f4d0a972811eda14a5254001e7c00","_blank")}),t.proxy(r,"click",()=>{window.open("https://afdian.com/dashboard/order","_blank")}),t.proxy(l,"click",()=>{window.open("https://scriptcat.org/scripts/code/162/%E9%98%BF%E9%87%8C%E4%BA%91%E7%9B%98.user.js","_blank")});const u=a("#order-input",e),p=a("#cancel-order",e),d=a("#submit-order",e);t.proxy(p,"click",({isTrusted:t})=>{t&&b()}),t.proxy(d,"click",()=>{if(u.value){const t=u.value.trim();if(t.match(/^202[\d]{22,25}$/)){if(t.match(/(\d)\1{7,}/g))return;(function(t){t=t.slice(0,14);const[,e,o,n,s,i,r]=(t.match(/^(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})$/)||[]).map(Number);return 5===[c(o,1,12)===o,c(n,1,31)===n,c(s,0,23)===s,c(i,0,59)===i,c(r,0,59)===r].filter(Boolean).length})(t)&&function(t){const e=i.get(t)||0;if(i.set(t,e+1),!(e>33))f().then(e=>h().then(o=>{const{authData:n,expire_time:s,shortId:r,username:a}=o.toJSON(),l=new(e.Object.extend("aliyundrive"));l.set("ON",t),l.set("pnum",i.get(t));for(let[t,e]of Object.entries({authData:n,expire_time:s,shortId:r,username:a}))l.set(t,e);return l.save().then(n=>{Object.assign(o.attributes,{ON:t,check:3,expire_time:new Date(Date.now()+864e3).toISOString()});const{expire_time:s}=o.toJSON();return i.set(e._getAVPath(e.User._CURRENT_USER_KEY),btoa(encodeURIComponent(JSON.stringify(s)))),o._handleSaveResult(!0)})}))}(t),b()}else s.show="此订单号不合规范，请重试"}else s.show="请输入订单号"})}})}function b(){if(w()){n.remove("sponsor"),t.constructor.CONTEXTMENU=r;try{o.resumeBuffering()}catch(t){o.startLoad()}}}function w(){if(n.hasOwnProperty("sponsor")){const{display:e,visibility:o,opacity:s}=window.getComputedStyle(n.sponsor);return"none"!==e&&"hidden"!==o&&0!==parseFloat(s)||t.destroy(),!0}return!1}function y(){t.contextmenu.update({index:53,html:"更多功能",click:()=>{g(),t.contextmenu.show=!1}}),t.setting.update({html:"更多功能",name:"more-setting",tooltip:"",selector:[{html:"更多功能",value:0},{html:"打赏作者",value:1}],onSelect:t=>(0===t.value?g():1===t.value&&window.open("https://jsd.nn.ci/gh/tampermonkeyStorage/Self-use@master/appreciation.png","_blank"),"")});let n=Number(i.get("pnum")||0);i.set("pnum",++n),t.on("video:ended",()=>{h().then(e=>{const{expire_time:o}=e.toJSON();Math.max(Date.parse(o)-Date.now(),0)||t.layers.update({name:"potser",html:'<img style="width: 300px" src="https://jsd.nn.ci/gh/tampermonkeyStorage/Self-use@master/appreciation.png">',tooltip:"",style:{position:"absolute",top:"50px",right:"50px"},click:(t,e)=>{window.open(e.target.src,"_blank")}})})}),o.on(e.Events.FRAG_LOADED,d((e,n)=>{h().then(e=>{t.emit("user",e.toJSON()),t.once("user",({expire_time:t})=>{Math.max(Date.parse(t)-Date.now(),0)?b():g(),f().then(e=>{new Set([i.get(e._getAVPath(e.User._CURRENT_USER_KEY)),btoa(encodeURIComponent(JSON.stringify(t)))]).size>1&&o.destroy()})})})},1e3*c(420,t.duration/100,t.duration/3)))}return t.isReady?y():t.once("ready",y),{name:"user",userJSON:function(){return h().then(t=>t.toJSON())},show:g}},()=>t=>{const e=window.Hls||unsafeWindow.Hls,{hls:o,option:n,notice:s}=t;var i=Date.now(),r=0;return o.on(e.Events.ERROR,(a,l)=>{if(l.fatal)switch(s.show=`当前带宽: ${Math.round(o.bandwidthEstimate/1024/1024/8*100)/100} MBps/s`,l.type){case e.ErrorTypes.NETWORK_ERROR:l.details===e.ErrorDetails.MANIFEST_LOAD_ERROR||l.details===e.ErrorDetails.MANIFEST_LOAD_TIMEOUT||l.details===e.ErrorDetails.MANIFEST_PARSING_ERROR?o.loadSource(o.url):l.details===e.ErrorDetails.FRAG_LOAD_ERROR?++r<10&&(o.loadSource(o.url),o.media.currentTime=t.currentTime,o.media.play()):o.startLoad();break;case e.ErrorTypes.MEDIA_ERROR:o.recoverMediaError();break;default:s.show="视频播放异常，请刷新重试",o.destroy()}else switch(l.type){case e.ErrorTypes.NETWORK_ERROR:l.details===e.ErrorDetails.FRAG_LOAD_ERROR&&function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6e3,o=t.match(/&x-oss-expires=(\d+)&/);return o?+"".concat(o[1],"000")-e<Date.now():Date.now()-i>3e5-e}(o.url)&&(r=0,i=Date.now(),o.stopLoad(),t.emit("resume",n.file))}}),{name:"hlsevents"}},()=>(function(t){const{i18n:e,option:o,notice:n,storage:s,controls:i,constructor:{utils:{isMobile:r,setStyle:a}}}=t;function l(t){return r?t.split(/\s/).shift():t}function u(){const r=o.quality,a=r.find(t=>t.default)||r[0];i.update({name:"quality",html:a?l(a.html):"",selector:r.map((t,e)=>({...t})),onSelect:o=>{if(o.url)return s.set("quality",l(o.html)),t.switchQuality(o.url),n.show=`${e.get("Switch Video")}: ${o.html}`,l(o.html);n.show="视频地址不可用"},mounted:()=>{const e=s.get("quality");if(e){const o=i.cache.get("quality").option.selector.find(t=>l(t.html)===e);o&&!o.default&&(t.switchQuality(o.url),i.check(o))}}})}function c(){u(),o.qualityid=o.id,t.on("restart",()=>{if(o.qualityid===o.id){const e=t.layers["auto-playback"];e&&a(e,"display","none")}else o.qualityid=o.id,u()})}return t.isReady?c():t.once("ready",c),{name:"quality"}}),()=>(function(t){const{i18n:e,proxy:o,option:n,notice:s,storage:i,controls:r,constructor:{utils:{query:a,isMobile:l,debounce:u}}}=t,c={showtext:!l,icon:'<i class="art-icon"><svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="22" height="22"><path d="M810.666667 384H85.333333v85.333333h725.333334V384z m0-170.666667H85.333333v85.333334h725.333334v-85.333334zM85.333333 640h554.666667v-85.333333H85.333333v85.333333z m640-85.333333v256l213.333334-128-213.333334-128z" fill="#ffffff"></path></svg></i>'};function p(){(n.filelist||[]).length>1&&(n.filelist,r.update({html:c.showtext?e.get("PlayList"):c.icon,name:"playlist",position:"right",tooltip:"",style:{marginLeft:"10px",marginRight:"10px"},selector:n.filelist.map((t,e)=>({...t,html:t.name,style:{textAlign:"left"}})),onSelect:o=>(n.file=o,n.id=o.file_id,t.emit("reload",o),s.show=`${e.get("Switch Video")}`,c.showtext?e.get("PlayList"):c.icon),mounted:()=>{const t=r.cache.get("playlist"),{$ref:e,option:{selector:n}}=t,s=a(".art-selector-list",e),i=a(".art-selector-value",e),l=s.offsetHeight,u=s.firstElementChild.offsetHeight;o(i,"click",t=>{const e=n.findIndex(t=>t.default);s.scrollTop=(e+1)*u-l/2})}}))}return e.update({"zh-cn":{PlayList:"播放列表"}}),t.isReady?p():t.once("ready",p),{name:"playlist"}}),()=>t=>{const{i18n:e,option:o,notice:n,setting:s,storage:i,plugins:r,subtitle:a,controls:l,template:u,contextmenu:c,constructor:{utils:{getExt:p,clamp:d,srtToVtt:h,assToVtt:m,vttToBlob:f,query:g,append:b,isMobile:w,debounce:y,throttle:x,loadScript:v,inverseClass:S}}}=t,k={showtext:!w,icon:'<i class="art-icon"><svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 48 48"><path d="M0 0h48v48H0z" fill="none"/><path fill="#ffffff" d="M40 8H8c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM8 24h8v4H8v-4zm20 12H8v-4h20v4zm12 0h-8v-4h8v4zm0-8H20v-4h20v4z"/></svg></i>',tooltip:'<label style="font-size: 0;padding: 4px;display: inline-block;"><span style="width: 20px;height: 20px;display: inline-block;border-radius: 50%;box-sizing: border-box;cursor: pointer;background: #FE9200;"></span></label>'};function _(s=[]){const i=s.find(t=>t.default)||Object.assign(s[0],{default:!0}),r=Object.assign({},{...o.subtitle},{style:o.subtitle.style},i);R({...r}).then(()=>{r.name&&(n.show=`加载字幕: ${r.name}`),u.$track.onerror=(e=>{n.show=`字幕加载失败: ${a.option.name}`,t.emit("subtitleError",a.cues,a.option)})}),l.update({html:k.showtext?"字幕列表":k.icon,name:"subtitle",position:"right",style:{paddingLeft:"10px",paddingRight:"10px"},selector:s.map((t,e)=>({...t})),onSelect:(s,i)=>{n.show=`${e.get("Switch Subtitle")}`;const r=Object.assign({},o.subtitle,{style:o.subtitle.style},s);return R({...r}).then(()=>{r.name&&(n.show=`${e.get("Switch Subtitle")}: ${r.name}`),u.$track.onerror=(e=>{n.show=`字幕加载失败: ${a.option.name}`,t.emit("subtitleError",a.cues,a.option)})}),k.showtext?"字幕列表":k.icon}})}function O(t=[]){t=Array.from(new Set(t)),l.hasOwnProperty("subtitle")?l.update({name:"subtitle",selector:t.map((t,e)=>({...t}))}):_(t)}function R(t){return t.text?Promise.resolve().then(()=>{const{type:e,text:o}=t;switch(e){case"srt":{const e=h(o),n=t.onVttLoad(e);return f(n)}case"ssa":case"ass":{const e=m(o),n=t.onVttLoad(e);return f(n)}case"webvtt":case"vtt":{const e=t.onVttLoad(o);return f(e)}default:return n.show=`无法识别的字幕格式: ${e}`,t.url}}).then(e=>(a.option=t,a.style(t.style),u.$subtitle.innerHTML="",a.url===e?e:(URL.revokeObjectURL(a.url),a.createTrack("metadata",e),e))).catch(t=>{throw u.$subtitle.innerHTML="",n.show=t,t}):t.url?a.init(t):(n.show=`不是正确的字幕文件: ${t.name}`,Promise.reject())}function D(t){return new Promise((e,o)=>{const n=new FileReader;n.readAsText(t,"UTF-8"),n.onload=(o=>{const s=n.result;return s.indexOf("�")>-1&&!n.markGBK?(n.markGBK=!0,n.readAsText(t,"GBK")):s.indexOf("")>-1&&!n.markBIG5?(n.markBIG5=!0,n.readAsText(t,"BIG5")):void e(s)}),n.onerror=(t=>{o(t)})})}function T(){(o.sublist||[]).length&&_(o.sublist),t.once("user",({expire_time:e})=>{if(Math.max(Date.parse(e)-Date.now(),0)){for(let[t,e]of Object.entries({color:i.get("subtitle-color"),bottom:i.get("subtitle-bottom"),fontSize:i.get("subtitle-fontSize"),fontWeight:i.get("subtitle-fontWeight"),fontFamily:i.get("subtitle-fontFamily"),textShadow:i.get("subtitle-textShadow")}))e&&a.style(t,e);t.on("subtitle",t=>i.set("subtitle",t));const e=i.get("subtitle");"boolean"==typeof e&&(a.show=e),t.on("sublist",t=>{(t||[]).length&&(o.sublist=(o.sublist||[]).concat(t),O(o.sublist))})}}),o.subid=o.id,t.on("restart",()=>{if(o.subid===o.id){(l.cache.get("subtitle").option.selector||[]).length&&a.createTrack("metadata",a.url)}else{o.subid=o.id;const{$subtitle:t}=u;t.innerHTML="",o.subtitle.url="",a.createTrack("metadata",""),l.hasOwnProperty("subtitle")&&l.remove("subtitle"),(o.sublist||[]).length&&O(o.sublist)}})}return s.update({html:"字幕设置",name:"subtitle-setting",tooltip:"",icon:'<svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 48 48"><path d="M0 0h48v48H0z" fill="none"/><path fill="#ffffff" d="M40 8H8c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM8 24h8v4H8v-4zm20 12H8v-4h20v4zm12 0h-8v-4h8v4zm0-8H20v-4h20v4z"/></svg>',selector:[{html:"显示",name:"subtitle",tooltip:"显示",switch:!0,onSwitch:t=>(t.tooltip=t.switch?"隐藏":"显示",a.show=!t.switch,!t.switch),mounted:(e,o)=>{const n=a.show;o.switch=n,o.tooltip=n?"显示":"隐藏",t.on("subtitle",t=>{setTimeout(()=>{o.switch!==t&&(o.switch=t,o.tooltip=t?"显示":"隐藏")})})}},{html:"字幕偏移",name:"subtitle-offset",tooltip:"0s",range:[0,-10,10,.1],onChange(e){const o=e.range[0];return t.subtitleOffset=o,o+"s"},mounted:(e,o)=>{t.on("subtitleOffset",t=>{setTimeout(()=>{o.$range.value=t,o.tooltip=t+"s"})})}},{html:"字幕位置",name:"subtitle-bottom",tooltip:"5%",range:[5,1,90,1],onChange(t){const e=t.range[0]+"%";return a.style({bottom:e}),i.set("subtitle-bottom",e),e},mounted:(t,e)=>{const o=i.get("subtitle-bottom");o&&(e.tooltip=o,e.$range.value=parseFloat(o))}},{html:"字体大小",name:"subtitle-fontSize",tooltip:"25px",range:[25,10,60,1],onChange(t){const e=t.range[0]+"px";return a.style({fontSize:e}),i.set("subtitle-fontSize",e),e},mounted:(t,e)=>{const o=i.get("subtitle-fontSize");o&&(e.tooltip=o,e.$range.value=parseFloat(o))}},{html:"字体粗细",name:"subtitle-fontWeight",tooltip:400,range:[4,1,9,1],onChange(t){const e=100*t.range[0];return i.set("subtitle-fontWeight",e),a.style({fontWeight:e}),e},mounted:(t,e)=>{const o=i.get("subtitle-fontWeight");o&&(e.tooltip=o,e.$range.value=o/100)}},{html:"字体颜色",name:"subtitle-color",tooltip:k.tooltip,selector:[{html:"预设",name:"color-presets",tooltip:'<style>.panel-setting-color label{font-size: 0;padding: 4px;display: inline-block;}.panel-setting-color input{display: none;}.panel-setting-color span{width: 22px;height: 22px;display: inline-block;border-radius: 50%;box-sizing: border-box;cursor: pointer;}</style><div class="panel-setting-color"><label><input type="radio" value="#fff"><span style="background: #fff;"></span></label><label><input type="radio" value="#e54256"><span style="background: #e54256"></span></label><label><input type="radio" value="#ffe133"><span style="background: #ffe133"></span></label><label><input type="radio" name="dplayer-danmaku-color-1" value="#64DD17"><span style="background: #64DD17"></span></label><label><input type="radio" value="#39ccff"><span style="background: #39ccff"></span></label><label><input type="radio" value="#D500F9"><span style="background: #D500F9"></span></label></div>'},{html:"默认颜色",name:"color-default",tooltip:k.tooltip},{html:"颜色选择器",name:"color-picker",tooltip:k.tooltip.replace("#FE9200","#000")}],onSelect:function(t,e,o){switch(t.name){case"color-presets":if("INPUT"===o.target.nodeName){const t=o.target.value;a.style({color:t}),i.set("subtitle-color",t)}break;case"color-default":a.style({color:"#FE9200"}),i.set("subtitle-color","#FE9200");break;case"color-picker":u.$colorPicker||(u.$colorPicker=b(u.$player,'<input hidden type="color">'),u.$colorPicker.oninput=(e=>{const o=e.target.value;a.style({color:o}),i.set("subtitle-color",o),t.tooltip=t.$parent.tooltip=k.tooltip.replace("#FE9200",o)})),u.$colorPicker.click()}return k.tooltip.replace("#FE9200",u.$subtitle.style.color)},mounted:(t,e)=>{const o=i.get("subtitle-color");o&&(e.tooltip=k.tooltip.replace("#FE9200",o))}},{html:"字体类型",name:"subtitle-fontFamily",tooltip:e.get("Default"),selector:[{html:"默认",value:""},{html:"等宽 衬线",value:'"Courier New", Courier, "Nimbus Mono L", "Cutive Mono", monospace'},{html:"比例 衬线",value:'"Times New Roman", Times, Georgia, Cambria, "PT Serif Caption", serif'},{html:"等宽 无衬线",value:'"Deja Vu Sans Mono", "Lucida Console", Monaco, Consolas, "PT Mono", monospace'},{html:"比例 无衬线",value:'Roboto, "Arial Unicode Ms", Arial, Helvetica, Verdana, "PT Sans Caption", sans-serif'},{html:"Casual",value:'"Comic Sans MS", Impact, Handlee, fantasy'},{html:"Cursive",value:'"Monotype Corsiva", "URW Chancery L", "Apple Chancery", "Dancing Script", cursive'},{html:"Small Capitals",value:'"Arial Unicode Ms", Arial, Helvetica, Verdana, "Marcellus SC", sans-serif'}],onSelect:function(t,e,o){return i.set("subtitle-fontFamily",t.html),a.style({fontFamily:t.value}),t.html},mounted:(t,e)=>{const o=i.get("subtitle-fontFamily");o&&(e.tooltip=o)}},{html:"描边样式",name:"subtitle-textShadow",tooltip:e.get("Default"),selector:[{html:"默认",value:"rgb(0 0 0) 1px 0 1px, rgb(0 0 0) 0 1px 1px, rgb(0 0 0) -1px 0 1px, rgb(0 0 0) 0 -1px 1px, rgb(0 0 0) 1px 1px 1px, rgb(0 0 0) -1px -1px 1px, rgb(0 0 0) 1px -1px 1px, rgb(0 0 0) -1px 1px 1px"},{html:"重墨",value:"rgb(0, 0, 0) 1px 0px 1px, rgb(0, 0, 0) 0px 1px 1px, rgb(0, 0, 0) 0px -1px 1px, rgb(0, 0, 0) -1px 0px 1px"},{html:"描边",value:"rgb(0, 0, 0) 0px 0px 1px, rgb(0, 0, 0) 0px 0px 1px, rgb(0, 0, 0) 0px 0px 1px"},{html:"45°投影",value:"rgb(0, 0, 0) 1px 1px 2px, rgb(0, 0, 0) 0px 0px 1px"},{html:"阴影",value:"rgb(34, 34, 34) 1px 1px 1.4875px, rgb(34, 34, 34) 1px 1px 1.98333px, rgb(34, 34, 34) 1px 1px 2.47917px"},{html:"凸起",value:"rgb(34, 34, 34) 1px 1px"},{html:"下沉",value:"rgb(204, 204, 204) 1px 1px, rgb(34, 34, 34) -1px -1px"},{html:"边框",value:"rgb(34, 34, 34) 0px 0px 1px, rgb(34, 34, 34) 0px 0px 1px, rgb(34, 34, 34) 0px 0px 1px, rgb(34, 34, 34) 0px 0px 1px, rgb(34, 34, 34) 0px 0px 1px"}],onSelect:function(t,e,o){return i.set("subtitle-textShadow",t.html),a.style({textShadow:t.value}),t.html},mounted:(t,e)=>{const o=i.get("subtitle-textShadow");o&&(e.tooltip=o)}},{name:"subtitle-load",html:"加载字幕",selector:[{html:"本地文件",name:"file",tooltip:"",node:b(u.$container,'<input type="file" accept=".webvtt,.vtt,.srt,.ssa,.ass" style="display: none;">')},{html:"本地文件夹",name:"files",tooltip:"",node:b(u.$container,'<input webkitdirectory multiple type="file" style="display: none;">')}],onSelect:function(t,e,n){const{userJSON:s,show:i}=r.user;return s().then(({expire_time:e})=>{Math.max(Date.parse(e)-Date.now(),0)?function(t){return t.click(),new Promise((e,o)=>{t.onchange=(t=>{if(t.target.files.length){const o=[...t.target.files].map(t=>{const e=t.name.split(".").pop().toLowerCase();if(["webvtt","vtt","srt","ssa","ass","smi"].includes(e))return D(t).then(o=>({text:o,type:e,name:t.name,html:`本地字幕「${e}」`,source:"local"}))}).filter(Boolean);Promise.all(o).then(t=>{e(t)})}t.target.value=""})})}(t.node).then(t=>{o.sublist=(o.sublist||[]).concat([t]),O(o.sublist)}):i()}),""}}]}),c.update({name:"subtitle",index:31,html:`字幕显示: ${[1,0].map(t=>`<span data-value="${t}">${t?"显示":"隐藏"}</span>`).join("")}`,click:(t,e)=>{S(e.target,"art-current");const{value:o}=e.target.dataset;a.show=Boolean(Number(o)),t.show=!1},mounted:e=>{const o=g(`[data-value='${Number(a.show)}']`,e);o&&S(o,"art-current"),t.on("subtitle",t=>{const o=g(`[data-value='${Number(t)}']`,e);o&&S(o,"art-current")})}}),t.isReady?T():t.once("ready",T),{name:"subtitle"}},()=>t=>{const{loadScript:e}=t.constructor.utils,{option:o,template:n,subtitle:s,storage:i,notice:r}=t;function a(){const{url:e,text:i,type:a}=s.option||o.subtitle||{};"ass"===a||"ssa"===a?function(){if(t.libass)return Promise.resolve(t.libass);const e={video:n.$video,subContent:"[Script Info]\nScriptType: v4.00+",subUrl:"",availableFonts:{"思源黑体 cn bold":"https://jsd.nn.ci/gh/tampermonkeyStorage/Self-use@master/Fonts/SourceHanSansCN-Bold.woff2"}};return function(t){if(unsafeWindow.queryLocalFonts){const e={};return t&&(e.postscriptNames=Array.isArray(t)?t:[t]),unsafeWindow.queryLocalFonts(e).then(t=>t&&t.length?t:Promise.reject())}return Promise.reject()}().then(t=>{const o=t.filter(t=>t.fullName.match(/[\u4e00-\u9fa5]/)),n=o.find(t=>["微软雅黑"].some(e=>t.fullName===e)).fullName||o.sort(()=>.5-Math.random())[0].fullName;return l({...e,fallbackFont:n,useLocalFonts:!0})}).catch(t=>l({...e,fallbackFont:Object.keys(e.availableFonts)[0]}))}().then(()=>{i?function(e){t.libass&&(t.libass.freeTrack(),t.libass.setTrack(e))}(i):e&&function(e){t.libass&&(t.libass.freeTrack(),t.libass.setTrackByUrl(e))}(e),c()}).catch(t=>{throw u(),p(),r.show=t,t}):(u(),p())}function l(o){let n="https://unpkg.com/jassub@1.7.18/dist/jassub.umd.js";return e(n).then(()=>(Object.assign(o,{workerUrl:new URL("jassub-worker.js",n).href,wasmUrl:new URL("jassub-worker.wasm",n).href,legacyWorkerUrl:new URL("jassub-worker.wasm.js",n).href,modernWasmUrl:new URL("jassub-worker-modern.wasm",n).href}),function({workerUrl:t}){return fetch(t).then(t=>t.text()).then(t=>{const e=new Blob([t],{type:"text/javascript"}),o=URL.createObjectURL(e);return setTimeout(()=>{URL.revokeObjectURL(o)}),o})}(o).then(e=>{o.workerUrl=e;const n=new unsafeWindow.JASSUB(o);return(n.canvasParent||n._canvasParent).style.cssText="position: absolute;top: 0;left: 0;width: 100%;height: 100%;user-select: none;pointer-events: none;z-index: 20;",t.libass=n,n})))}function u(){t.libass&&t.libass.freeTrack()}function c(){t.libass?(s.style({visibility:"hidden"}),(t.libass.canvasParent||t.libass._canvasParent).style.display="block",t.libass.resize()):s.style({visibility:"visible"})}function p(){s.style({visibility:"visible"}),t.libass&&((t.libass.canvasParent||t.libass._canvasParent).style.display="none")}function d(){t.libass&&(t.libass.destroy&&t.libass.destroy(),t.libass.dispose&&t.libass.dispose(),t.libass=null)}function h(){t.once("user",({expire_time:e})=>{Math.max(Date.parse(e)-Date.now(),0)&&(t.on("subtitleLoad",a),t.on("forceAss",a),t.on("subtitleOffset",e=>{!function(e){t.libass&&(t.libass.timeOffset=e)}(e)}),t.on("subtitle",t=>{t?c():p()}),t.on("restart",u),t.once("destroy",d))})}return t.isReady?h():t.once("ready",h),{name:"libass"}},()=>t=>{const{notice:e,storage:o,plugins:n,setting:s}=t;function i(){t.once("user",({expire_time:e})=>{Math.max(Date.parse(e)-Date.now(),0)&&function(){const e=window.Joysound||unsafeWindow.Joysound;e&&e.isSupport()&&(t.joySound=t.joySound||new e,t.joySound.hasSource()||t.joySound.init(t.template.$video),o.get("joysound")&&t.joySound.setEnabled(!0))}()})}return s.add({html:"声音设置",name:"joysound",tooltip:"",selector:[{html:"音质增强",name:"high",tooltip:"关闭",switch:!1,onSwitch:s=>{const i=s.switch;s.tooltip=i?"关闭":"开启";const{userJSON:r,show:a}=n.user;return r().then(({expire_time:n})=>{Math.max(Date.parse(n)-Date.now(),0)?(o.set("joysound",!i),t.joySound&&t.joySound.setEnabled(!i),e.show=`音质增强: ${i?"关闭":"开启"}`):a()}),!i},mounted:(t,e)=>{o.get("joysound")&&(e.tooltip="增强",e.switch=!0)}},{html:"音量增强",name:"volume",tooltip:"0x",range:[0,0,10,.1],onRange:o=>{const s=o.range[0]/10,{userJSON:i,show:r}=n.user;return i().then(({expire_time:o})=>{Math.max(Date.parse(o)-Date.now(),0)?(t.joySound&&t.joySound.setVolume(s),e.show=`音量增强: ${100+100*s}%`):r()}),`${Math.round(100*o.range[0])/100}x`}}]}),t.playing?i():t.once("video:playing",i),{name:"sound"}},()=>t=>{const{notice:e,storage:o,plugins:n,setting:s,template:{$video:{style:i}}}=t;function r(){t.once("user",({expire_time:t})=>{if(Math.max(Date.parse(t)-Date.now(),0)){const{saturate:t=1,brightness:e=1,contrast:n=1}=o.get("filter")||{};i.filter=`saturate(${t}) brightness(${e}) contrast(${n})`}})}return s.update({html:"色彩滤镜",name:"filter",tooltip:"",selector:[{html:"饱和度",name:"saturate",tooltip:100,range:[100,0,255,1],onRange:t=>{const s=t.range[0],{userJSON:r,show:a}=n.user;return r().then(({expire_time:t})=>{if(Math.max(Date.parse(t)-Date.now(),0)){e.show=`饱和度: ${s}`,o.set("filter",{...o.get("filter"),saturate:s/100});const{saturate:t=1,brightness:n=1,contrast:r=1}=o.get("filter")||{};i.filter=`saturate(${t}) brightness(${n}) contrast(${r})`}else a()}),s},mounted:(t,e)=>{const{saturate:n=1}=o.get("filter")||{};e.$range.value=100*n,e.tooltip=100*n}},{html:"亮度",name:"brightness",tooltip:100,range:[100,0,255,1],onRange:t=>{const s=t.range[0],{userJSON:r,show:a}=n.user;return r().then(({expire_time:t})=>{if(Math.max(Date.parse(t)-Date.now(),0)){e.show=`亮度: ${s}`,o.set("filter",{...o.get("filter"),brightness:s/100});const{saturate:t=1,brightness:n=1,contrast:r=1}=o.get("filter")||{};i.filter=`saturate(${t}) brightness(${n}) contrast(${r})`}else a()}),s},mounted:(t,e)=>{const{brightness:n=1}=o.get("filter")||{};e.$range.value=100*n,e.tooltip=100*n}},{html:"对比度",name:"contrast",tooltip:100,range:[100,0,255,1],onRange:t=>{const s=t.range[0],{userJSON:r,show:a}=n.user;return r().then(({expire_time:t})=>{if(Math.max(Date.parse(t)-Date.now(),0)){e.show=`对比度: ${s}`,o.set("filter",{...o.get("filter"),contrast:s/100});const{saturate:t=1,brightness:n=1,contrast:r=1}=o.get("filter")||{};i.filter=`saturate(${t}) brightness(${n}) contrast(${r})`}else a()}),s},mounted:(t,e)=>{const{contrast:n=1}=o.get("filter")||{};e.$range.value=100*n,e.tooltip=100*n}},{html:"预设「1」",name:"filter-presets",tooltip:""},{html:"默认",name:"filter-default",tooltip:""}],onSelect:(t,e,r)=>{const{userJSON:a,show:l}=n.user;return a().then(({expire_time:e})=>{if(Math.max(Date.parse(e)-Date.now(),0)){const e=s.find("saturate"),n=s.find("brightness"),r=s.find("contrast");"filter-presets"===t.name?(e.tooltip=110,e.$range.value=110,n.tooltip=105,n.$range.value=105,r.tooltip=101,r.$range.value=101,o.set("filter",{saturate:1.1,brightness:1.05,contrast:1.01}),i.filter="saturate(1.1) brightness(1.05) contrast(1.01)"):"filter-default"===t.name&&(e.tooltip=100,e.$range.value=100,n.tooltip=100,n.$range.value=100,r.tooltip=100,r.$range.value=100,o.set("filter",{saturate:1,brightness:1,contrast:1}),i.filter="")}else l()}),t.html}}),t.isReady?r():t.once("ready",r),{name:"imagefilter"}},()=>t=>{const{i18n:e,notice:o,storage:n,plugins:s,setting:i,controls:r,constructor:{utils:{throttle:a}}}=t;function l(){t.once("user",({expire_time:e})=>{Math.max(Date.parse(e)-Date.now(),0)&&(n.get("auto-fullscreen")&&(t.fullscreenWeb=!0),t.startTime=n.get("startTime"),t.endTime=n.get("endTime"),t.on("video:timeupdate",a(()=>{const{currentTime:e,duration:o,startTime:n,endTime:s}=t;if(n||s){const i=[[0,n||0],[s?o-s:0,s?o:0]];for(const[o,n]of i)if(e>=o&&e<n){t.seek=n;break}}},1e3)),t.on("video:ended",()=>{if(n.get("auto-next")&&r.hasOwnProperty("playlist")){const t=r.cache.get("playlist").option.selector,e=t[t.findIndex(t=>t.default)+1];e?e.$control_item.click():o.show="没有下一集了"}}))})}return i.update({html:"播放设置",name:"play-setting",tooltip:"",selector:[{html:"自动下一集",name:"auto-next",icon:"",tooltip:"关闭",switch:!1,onSwitch:t=>{const e=t.switch;t.tooltip=e?"关闭":"开启";const{userJSON:i,show:r}=s.user;return i().then(({expire_time:t})=>{Math.max(Date.parse(t)-Date.now(),0)?(n.set("auto-next",!e),o.show=`自动下一集: ${e?"关闭":"开启"}`):r()}),!e},mounted:(t,e)=>{n.get("auto-next")&&(e.tooltip="开启",e.switch=!0)}},{html:"自动全屏",name:"auto-fullscreen",icon:"",tooltip:"关闭",switch:!1,onSwitch:e=>{const i=e.switch;e.tooltip=i?"关闭":"开启";const{userJSON:r,show:a}=s.user;return r().then(({expire_time:e})=>{Math.max(Date.parse(e)-Date.now(),0)?(t.fullscreenWeb=!i,n.set("auto-fullscreen",!i),o.show=`自动全屏: ${i?"关闭":"开启"}`):a()}),!i},mounted:(t,e)=>{n.get("auto-fullscreen")&&(e.tooltip="开启",e.switch=!0)}},{html:"跳过片头",tooltip:"0s",range:[0,0,120,1],onChange(e){const i=e.range[0],{userJSON:r,show:a}=s.user;return r().then(({expire_time:e})=>{Math.max(Date.parse(e)-Date.now(),0)?(t.startTime=i,n.set("startTime",i),o.show=`跳过片头: ${i} 秒`):a()}),i+"s"},mounted:(t,e)=>{const o=n.get("startTime");o&&(e.range=[o,0,120,1],e.tooltip=o+"s")}},{html:"跳过片尾",tooltip:"0s",range:[0,0,120,1],onChange(e){const i=e.range[0],{userJSON:r,show:a}=s.user;return r().then(({expire_time:e})=>{Math.max(Date.parse(e)-Date.now(),0)?(t.endTime=i,n.set("endTime",i),o.show=`跳过片尾: ${i} 秒`):a()}),i+"s"},mounted:(t,e)=>{const o=n.get("endTime");o&&(e.range=[o,0,120,1],e.tooltip=o+"s")}}]}),t.isReady?l():t.once("ready",l),{name:"play"}},()=>t=>{const{option:e,controls:o,template:{$video:n},constructor:{FAST_FORWARD_VALUE:s,utils:{isMobile:i}}}=t;let r=null,a=!1,l=1;const u=e=>{0===e.button&&(r=setTimeout(()=>{a=!0,o.show=!1,l=t.playbackRate,t.playbackRate*=s},1e3))},c=()=>{clearTimeout(r),setTimeout(()=>{a&&(a=!1,o.show=!1,t.playbackRate=l,t.play())})};function p(){t.once("user",({expire_time:o})=>{Math.max(Date.parse(o)-Date.now(),0)&&(i||(n.addEventListener("mousedown",u),document.addEventListener("mouseup",c)),e.hotkey&&!i&&(t.isFocus||(t.isFocus=!0)),t.on("blur",o=>{e.hotkey&&!i&&(t.isFocus=!0)}))})}return t.isReady?p():t.once("ready",p),{name:"hotkey"}}]);
